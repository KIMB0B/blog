---
title: 14. ë¹ˆì˜ ë²”ìœ„ë¥¼ ì •í•´ì£¼ì! ë¹ˆ ìŠ¤ì½”í”„ (Bean Scope)
date: 2024-03-14T01:00:00
---
ì•ˆë…•í•˜ì„¸ìš”!

ìŠ¤í”„ë§ ë¹ˆì„ ë§Œë“¤ê³  ëª¨ë“  ë¹ˆì´ í–‰ë³µí•˜ê²Œ ì˜¤ë˜ì˜¤ë˜ ì‚´ì•˜ìœ¼ë©´ ì¢‹ê² ì§€ë§Œ! ê·¸ë ‡ì§€ ì•Šì•„ì•¼ ìœ ìš©í•  ë•Œë„ ì˜¤ê² ì£ ?Â 
ê·¸ëŸ´ ë• Scopeë¼ëŠ” ê¸°ëŠ¥ì„ ì´ìš©í•´ ë´…ì‹œë‹¤!

![](https://blog.kakaocdn.net/dn/cmophF/btsFLUrSjum/V94RTZcvYP7SkaKJNoJl4K/img.jpg)

ë•…~

[[13. ë¹ˆì˜ ì¼ëŒ€ê¸°! ìƒëª… ì£¼ê¸° ì½œë°±|ğŸ‘‰ì´ì „ ê¸€ ë³´ëŸ¬ê°€ê¸°]]

---

# ìŠ¤ì½”í”„(Scope) ì•Œì•„ë³´ê¸°

![](https://blog.kakaocdn.net/dn/c1HeVK/btsFJJZq5Ri/msV4mzS8H4BigjeIem1hwk/img.png)

(ë‚œ ìŠ¤ë‚˜ì´í¼ ìœ„ì— ì¡°ì¤€ê²½ ê·¸ê±°ì¸ì¤„...)

ìŠ¤ì½”í”„ëŠ” ë²ˆì—­í•˜ë©´ ë²”ìœ„ë¼ê³  í•©ë‹ˆë‹¤. ê·¸ë˜ì„œ ë§ ê·¸ëŒ€ë¡œ ìŠ¤í”„ë§ ë¹ˆì´ ì‚´ì•„ì„œ ë‚´ ì½”ë“œì— ì˜í–¥ì„ ì¤„ ë²”ìœ„ë¥¼ ì§€ì •í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

ì—¬ëŸ¬ë¶„ í˜¹ì‹œ ì´ì „ì— ì‹±ê¸€í†¤ê³¼ ê´€ë ¨í•´ì„œ ë°°ì› ë˜ ê²ƒì„ ê¸°ì–µí•˜ì‹¤ê¹Œìš”?
ì‹±ê¸€í†¤ì€ ìš°ë¦¬ì˜ ìŠ¤í”„ë§ í”„ë¡œê·¸ë¨ì´ ì‹œì‘í•˜ë©´ì„œ ë”± í•˜ë‚˜ë§Œ ë§Œë“¤ì–´ì ¸ì„œ ê·¸ê²Œ ì­‰ ê´€ë¦¬ëœë‹¤ê³  ê¸°ì–µë‚˜ì‹¤ ê²ë‹ˆë‹¤. ê·¸ë¦¬ê³  ìŠ¤í”„ë§ì—ì„  ë¹ˆë“¤ì—ê²Œ ê¸°ë³¸ê°’ìœ¼ë¡œ ì‹±ê¸€í†¤ì„ ì ìš©í•œë‹¤ê³  í–ˆì—ˆìŠµë‹ˆë‹¤.

ë°”ë¡œ ì´ ì‹±ê¸€í†¤ì´ ìš°ë¦¬ê°€ ì˜¤ëŠ˜ ë°°ìš¸ ìŠ¤ì½”í”„ì˜ í•œ ì¢…ë¥˜ì…ë‹ˆë‹¤! ê·¸ë ‡ë‹¤ëŠ” ê²ƒì€ ì‹±ê¸€í†¤ ë°©ì‹ì´ ì•„ë‹Œ ë‹¤ë¥¸ ë°©ì‹ì˜ ìŠ¤ì½”í”„ë„ ìˆëŠ” ê²ƒì´ê² ì£ ? í•œë²ˆ ì•Œì•„ë´…ì‹œë‹¤.

- **ì‹±ê¸€í†¤(singleton):**Â ê¸°ë³¸ê°’.Â ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì‹œì‘í•˜ë©´ì„œ ì¢…ë£Œë  ë•Œê¹Œì§€Â  ìœ ì§€ë˜ëŠ” ì•„ì£¼ ê¸´ ìŠ¤ì½”í”„
- **í”„ë¡œí† íƒ€ì…(prototype):**Â ë¹ˆì˜ ìƒì„±ë¶€í„° ì˜ì¡´ê´€ê³„ ì£¼ì…ê¹Œì§€Â ê´€ì—¬ë˜ê³  ê·¸ ì´í›„ ì‚¬ë¼ì§€ëŠ” ì§§ì€ ìŠ¤ì½”í”„
- **ì›¹ ê´€ë ¨)**
    - **request:**Â ì›¹ì˜ ìš”ì²­ì´ ë“¤ì–´ì˜¤ê³  ë‚˜ê°ˆ ë•Œê¹Œì§€ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„
    - **session:**Â ì›¹ ì„¸ì…˜ì´ ìƒì„±ë˜ê³  ì¢…ë£Œë  ë•Œ ê¹Œì§€ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„
    - **application:**Â ì›¹ì˜Â ì„œë¸”ë¦¿ ì½˜í…ìŠ¤íŠ¸ì™€Â ê°™ì€ ë²”ìœ„ë¡œ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„

ìš°ë¦° ì—¬ê¸°ì„œ ì‹±ê¸€í†¤ì€ ì „ì— í•œë²ˆ ì•Œì•„ë´¤ìœ¼ë‹ˆ í”„ë¡œí† íƒ€ì…, ê·¸ë¦¬ê³  requestì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

---
# í”„ë¡œí† íƒ€ì…(Prototype) ìŠ¤ì½”í”„

## **ì ìš©í•´ ë³´ê¸°**

ì¼ë‹¨ ì €í¬ê°€ ì‹±ê¸€í†¤ì´ ì ìš©ëë˜ ë°©ì‹ë¶€í„° ë˜ì§šì–´ë´…ì‹œë‹¤.

![](https://blog.kakaocdn.net/dn/b2CwSi/btsFNmVjdyB/6A017edKnwu8A7PUgm95p0/img.png)

ì»¨í…Œì´ë„ˆëŠ” ë”± í•˜ë‚˜ì˜ í•´ë‹¹ ë¹ˆì„ ìƒì„±í•˜ê³  ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸ê°€ ì‚¬ìš©ì„ ìš”ì²­í–ˆì„ ë•Œ ë§Œë“¤ì–´ë†“ì€ ë”± í•˜ë‚˜ì˜ ë™ì¼í•œ ë¹ˆì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë°˜í™˜í•´ ì£¼ëŠ” ë°©ì‹ì´ì—ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¼ í”„ë¡œí† íƒ€ì…ì€ ì–´ë–¤ ëŠë‚Œìœ¼ë¡œ ì‘ë™ë ê¹Œìš”?

![](https://blog.kakaocdn.net/dn/bZVEND/btsFNoZTACd/lPB5NKq8ydLREbm1vVYha1/img.png)

ë¨¼ì € ì»¨í…Œì´ë„ˆëŠ” í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë¹ˆì„ ì“°ê² ë‹¤ëŠ” ìš”ì²­ì´ ì™”ì„ ë•Œ ê·¸ì œì•¼ í•´ë‹¹ ë¹ˆì„ ìƒì„±í•˜ê³ , í•„ìš”í•œ ì˜ì¡´ê´€ê³„ë¥¼ ì£¼ì…í•©ë‹ˆë‹¤. ê·¸ê²ƒë„ ìš”ì²­ì´ ë“¤ì–´ì˜¨ ìˆ˜ë§Œí¼ ì—¬ëŸ¬ ê°œ ë§Œë“¤ê²Œ ë©ë‹ˆë‹¤.

![](https://blog.kakaocdn.net/dn/zhDs3/btsFJ5nE3yB/EIGMFKREPkgaXIjrpNSwNK/img.png)

ê·¸ í›„ì— ê° í´ë¼ì´ì–¸íŠ¸ë§ˆë‹¤ ë¬¼ë¡  ê°™ì€ ë™ì‘ì„ í•  ë¹ˆì´ì§€ë§Œ ë³„ê°œì˜ ë…ë¦½ëœ ë¹ˆë“¤ì„ í•˜ë‚˜ì”© ë°˜í™˜ì„ í•´ ì¤ë‹ˆë‹¤. ê·¸ ì´í›„ë¡œ ì»¨í…Œì´ë„ˆëŠ” ë°˜í™˜í•œ ë¹ˆì„ ê´€ë¦¬í•˜ì§€ ì•Šê³  ì•Œì•„ì„œ ì§€ì§€ê³  ë³¶ë“  ë­˜ í•˜ë“  ë§˜ëŒ€ë¡œ í•˜ë¼ê³  í•©ë‹ˆë‹¤.

ì¤‘ìš”í•œ ì ì€Â **ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•˜ê³  ì˜ì¡´ê´€ê³„ ì£¼ì…ê¹Œì§€ë§Œ í•´ì£¼ê³ , ë°˜í™˜ í›„ì—” ë§Œë“¤ì–´ì§„ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ê´€ë¦¬í•˜ì§€ ì•ŠëŠ”ë‹¤**ëŠ” ì ì…ë‹ˆë‹¤.
ê·¸ë˜ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆë“¤ì€ ë¹ˆì„ ë°›ì€ í´ë¼ì´ì–¸íŠ¸ê°€ ê´€ë¦¬í•  ì±…ì„ì´ ìˆê³ , ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë˜ëŠ” ê±°ë‘ ë§Œë“¤ì–´ì§„ í”„ë¡œí† íƒ€ì… ë¹ˆë“¤ê³¼ëŠ” ìƒê´€ì´ ì—†ì–´ì§€ê¸° ë•Œë¬¸ì— @PreDestroy ê°™ì€ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ì •ë§ë¡œ ê·¸ëŸ°ì§€ í•œë²ˆ ë´ë³¼ê¹Œìš”? í…ŒìŠ¤íŠ¸ ìª½ì— prototypeíŒ¨í‚¤ì§€ë¥¼ ë§Œë“¤ê³  PrototypeTest.javaë¥¼ ë§Œë“¤ì–´ë´…ì‹œë‹¤.

![](https://blog.kakaocdn.net/dn/bqFdlD/btsFK7STkhq/SD8QrKctzUKyB3QIAsnGnk/img.png)

```java
    @Scope("prototype")
    static class PrototypeBean {

        @PostConstruct
        public void init() {
            System.out.println("PrototypeBean.init");
        }

        @PreDestroy
        public void destroy() {
            System.out.println("PrototypeBean.destroy");
        }
        
        private int count = 0;
        
        public void addCount() {
            count++;
        }
        
        public int getCount() {
            return count;
        }
    }
```

ìš”ë ‡ê²Œ ì„ì‹œë¡œ PostConstructì™€ PreDestroyë•Œ ê¸°ëŠ¥í•  ë©”ì„œë“œë¥¼ ê°€ì§€ê³  ìˆëŠ” ë¹ˆ í´ë˜ìŠ¤ë¥¼ í•˜ë‚˜ ë§Œë“¤ê³ , ì¶”ê°€ë¡œ ì•„ë˜ í…ŒìŠ¤íŠ¸ë„ ì¶”ê°€í•´ ë´…ì‹œë‹¤.

```java
    @Test
    @DisplayName("í”„ë¡œí† íƒ€ì… ë¹ˆ ì¡°íšŒ")
    public void prototypeBeanFind() {
        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(PrototypeBean.class);
        PrototypeBean prototypeBean1 = ac.getBean(PrototypeBean.class);
        PrototypeBean prototypeBean2 = ac.getBean(PrototypeBean.class);
        System.out.println("prototypeBean1 = " + prototypeBean1);
        System.out.println("prototypeBean2 = " + prototypeBean2);
        Assertions.assertThat(prototypeBean1).isNotSameAs(prototypeBean2);
    }
```

PrototypeBean íƒ€ì…ì˜ ë¹ˆì„ 2ê°œ ìƒì„±í•˜ë©´ì„œ ë‘ ë¹ˆì´ ì„œë¡œ ë‹¬ë¼ì•¼ ì„±ê³µí•˜ëŠ” í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤.

**ì‹¤í–‰ ê²°ê³¼**

![](https://blog.kakaocdn.net/dn/bkWkuL/btsFMDcn1Xt/6pES84tAArV5XBZknQ6iq0/img.png)

í…ŒìŠ¤íŠ¸ ê²°ê³¼ëŠ” ì˜ˆìƒëŒ€ë¡œ ì„±ê³µí–ˆìŠµë‹ˆë‹¤.

ë³´ì‹œë©´ init() ë©”ì„œë“œê°€ ë‘ ë²ˆ ì‹¤í–‰ëœ ê²ƒì„ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ë‘ë²ˆ ì‚¬ìš©ìš”ì²­ì´ ë“¤ì–´ê°„ PrototypeBeanì´ ì´ ë‘ë²ˆ ìƒì„±ì´ ë˜ë©´ì„œ init() ë©”ì„œë“œê°€ ë‘ë²ˆ ì‹¤í–‰ëœ ê²ƒì…ë‹ˆë‹¤.
ê·¸ë¦¬ê³  ì•„ë˜ ê²°ê³¼ì—ì„œ ë³´ì‹œë‹¤ì‹œí”¼ prototypeBean1ê³¼ prototypeBean2ì˜ ë¹ˆ ì£¼ì†Œê°€ ë‹¤ë¥¸ ê²ƒì„ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹±ê¸€í†¤ ë°°ì› ì—ˆì„ ë•ŒëŠ” ê°™ì•˜ì—ˆë˜ ê±° ê¸°ì–µí•˜ì‹œì£ ?

ê·¸ë¦¬ê³  í•˜ë‚˜ ë” ì €í¬ê°€ ë§Œë“¤ì–´ë†¨ë˜ ê¸°ëŠ¥ì¸ countë¥¼ ì¦ê°€ì‹œí‚¤ê³  ì¡°íšŒí•˜ëŠ” ë©”ì„œë“œë¥¼ í†µí•´ ê°ê°ì˜ ë¹ˆë“¤ì´ ë³„ê°œì˜ í™˜ê²½ì—ì„œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•´ ë³¼ê¹Œìš”?

```java
    @Test
    @DisplayName("í”„ë¡œí† íƒ€ì… ë¹ˆ ë³„ê°œ í™˜ê²½ í™•ì¸")
    public void prototypeBeanEachCountUp() {
        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(PrototypeBean.class);
        PrototypeBean prototypeBean1 = ac.getBean(PrototypeBean.class);
        PrototypeBean prototypeBean2 = ac.getBean(PrototypeBean.class);
        prototypeBean1.addCount();
        System.out.println(prototypeBean1.getCount());
        Assertions.assertThat(prototypeBean1.getCount()).isEqualTo(1);
        prototypeBean2.addCount();
        System.out.println(prototypeBean1.getCount());
        Assertions.assertThat(prototypeBean2.getCount()).isEqualTo(1);
    }
```

ì‹±ê¸€í†¤ ë°©ì‹ì´ë¼ë©´ ìœ„ì˜ í…ŒìŠ¤íŠ¸ëŠ” ë¬¸ì œê°€ ë°œìƒí•  ê²ƒì…ë‹ˆë‹¤. í•˜ë‚˜ì˜ ë¹ˆì„ ê³µìœ í•˜ë©´ì„œ ì‘ì—…ì´ ë˜ê¸° ë•Œë¬¸ì— prototypeBean1ì—ì„œ addCount()ë¥¼ í•˜ë©´ì„œ countëŠ” 1, ê·¸ë¦¬ê³ Â prototypeBean2ì—ì„œ addCount()ë¥¼ í•˜ë©´ì„œ countëŠ”Â 2ê°€ ë˜ì—ˆì„ ê²ƒ ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ í”„ë¡œí† íƒ€ì…ì´ë¼ë©´?

**ì‹¤í–‰ê²°ê³¼**

![](https://blog.kakaocdn.net/dn/bjtMjw/btsFJ9jjqkw/n25mo4x7pKLFlIXlHlpMs1/img.png)

í…ŒìŠ¤íŠ¸ëŠ” ì—­ì‹œ ì„±ê³µí–ˆìŠµë‹ˆë‹¤. ê°ê° ë³„ê°œì˜ PrototypeBeanì„ ì‘ì—…í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— prototypeBean1ì—ì„œ addCount()ë¥¼ í–ˆë‹¤ê³  í•˜ë”ë¼ë„ prototypeBean2ì—ì„œëŠ” countê°€ ì¦ê°€ë˜ì§€ ì•Šì€ ìƒíƒœì´ê¸° ë•Œë¬¸ì— ìœ„ì™€ ê°™ì´ í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µí•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

## **ì‹±ê¸€í†¤ ë¹ˆê³¼ í•¨ê»˜ ì‚¬ìš© ì‹œ ë¬¸ì œì **

ì¼ë‹¨ ì´ë ‡ê²Œ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì˜ ì‚¬ìš©í•´ ë´¤ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ í”„ë¡œí† íƒ€ì… ë¹ˆì´ ì‹±ê¸€í†¤ íƒ€ì…ì˜ ë¹ˆì—ê²Œ ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ ë˜ë©´ ë¬¸ì œê°€ í•˜ë‚˜ ìƒê¸°ê²Œ ë©ë‹ˆë‹¤.

![](https://blog.kakaocdn.net/dn/4maDO/btsFK8dacGv/n0yQCQYm6LjC6P2ng1JBL1/img.png)

ìš°ë¦¬ê°€ ë§Œë“  PrototypeBeanì„ ì‹±ê¸€í†¤ íƒ€ì…ì˜ ë¹ˆì´ ì˜ì¡´ê´€ê³„ ì£¼ì…í•œë‹¤ë©´ ìœ„ì™€ ê°™ì´ PrototypeBeanì˜ ì°¸ì¡°ê°’ì„ ë³´ê´€í•˜ê²Œ ë©ë‹ˆë‹¤.

ë§Œì•½ ClientBeanì— logic()ì´ë¼ëŠ” ë©”ì„œë“œê°€ ìˆê³  ì´ê²Œ PrototypeBeanì˜ addCount()ì™€ getCount()ë¥¼ í•´ì„œ countê°’ì„ returní•´ì£¼ëŠ” ê¸°ëŠ¥ì´ë¼ê³  í•´ë´…ì‹œë‹¤.

![](https://blog.kakaocdn.net/dn/cwktLe/btsFM3PidbE/66URpJucpkKkjtGSuPgOM0/img.png)

í•œ í´ë¼ì´ì–¸íŠ¸ê°€ ì‹±ê¸€í†¤ íƒ€ì…ì¸ ClientBeanì— logic()ì„ í˜¸ì¶œí–ˆë‹¤ê³  í•©ì‹œë‹¤. ê·¸ëŸ¼ countëŠ” ì¦ê°€í•˜ì—¬ 1ì„ ë°˜í™˜í•´ ì¤„ ê²ƒì…ë‹ˆë‹¤.

![](https://blog.kakaocdn.net/dn/w7e2I/btsFM2bLb3n/EWLjkehts0fD6Xmz2yFkzK/img.png)

ë˜ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ê°€ ClientBeanì— logic()ì„ í˜¸ì¶œí–ˆë‹¤ê³  í•©ì‹œë‹¤. ì›ë˜ë¼ë©´ í”„ë¡œí† íƒ€ì…ì˜ ë¹ˆì€ ê°ê°ì˜ í´ë¼ì´ì–¸íŠ¸ë§ˆë‹¤ ë‹¤ë¥¸ ë³„ê°œì˜ Beanì„ ì¤˜ì„œ ë³„ê°œë¡œ ì‘ë™í•´ì•¼ í•˜ì§€ë§Œ, ì§€ê¸ˆ PrototypeBeanì€ ê°™ì€ í•˜ë‚˜ì˜ ClientBeanì—ì„œ ì‘ë™í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ ë‘ í´ë¼ì´ì–¸íŠ¸ì—ê²Œì„œ logic()ì„ í˜¸ì¶œë‹¹í–ˆë‹¤ í•´ë„ ì´ë¡œ ì¸í•´ addCount()ì™€ getCount()ë¥¼ ì‹¤í–‰ì‹œí‚¨ ë¹ˆì€ ì‹±ê¸€í†¤ íƒ€ì…ì˜ ClientBean í•˜ë‚˜ì´ê¸° ë•Œë¬¸ì— countëŠ” 2ê°€ ë˜ì–´ 2ê°€ í˜¸ì¶œë˜ì–´ ë²„ë¦½ë‹ˆë‹¤.

ì½”ë“œë¡œ ì•Œì•„ë´…ì‹œë‹¤! SingletonWithPrototypeTest1ë¼ëŠ” í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ë´…ì‹œë‹¤.
ê·¸ë¦¬ê³  ì•„ë˜ í´ë˜ìŠ¤ë“¤ê³¼ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë„£ì–´ì¤ì‹œë‹¤.

```java
 // PrototypeBean(í”„ë¡œí† íƒ€ì…)
 
     @Scope("prototype")
    static class PrototypeBean {
        private int count = 0;
        public void addCount() {
            count++;
        }
        public int getCount() {
            return count;
        }
        @PostConstruct
        public void init() {
            System.out.println("PrototypeBean.init " + this);
        }
        @PreDestroy
        public void destroy() {
            System.out.println("PrototypeBean.destroy");
        }
    }
```

```java
// ClientBean(ì‹±ê¸€í†¤)

    static class ClientBean {
        private final PrototypeBean prototypeBean;
        @Autowired
        public ClientBean(PrototypeBean prototypeBean) { this.prototypeBean = prototypeBean;
        }
        public int logic() {
            prototypeBean.addCount();
            int count = prototypeBean.getCount();
            return count;
        }
    }
```

```java
// í…ŒìŠ¤íŠ¸ ì½”ë“œ

    @Test
    void singletonClientUsePrototype() {
        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(ClientBean.class, PrototypeBean.class);
        ClientBean clientBean1 = ac.getBean(ClientBean.class);
        int count1 = clientBean1.logic();
        Assertions.assertThat(count1).isEqualTo(1);
        ClientBean clientBean2 = ac.getBean(ClientBean.class);
        int count2 = clientBean2.logic();
        Assertions.assertThat(count2).isEqualTo(2);
    }
```

**ì‹¤í–‰ ê²°ê³¼**

![](https://blog.kakaocdn.net/dn/0Bzqo/btsFK9b79FA/Q155ApSD6KvbkeBtjgJ2S0/img.png)

ìš°ë ¤í•œ ëŒ€ë¡œ í”„ë¡œí† íƒ€ì…ì´ì§€ë§Œ ì‹±ê¸€í†¤ ë¹ˆì—ê²Œ ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ ë˜ì—ˆë‹¤ëŠ” ì´ìœ ë¡œ ì˜ë„ëŒ€ë¡œ ì‘ë™í•˜ì§€ ëª»í•˜ê³  ìˆìŠµë‹ˆë‹¤.

## **í•´ê²°ë²•**

ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•ì€ ìŠ¤í”„ë§ì´ ì§€ì›í•´ ì£¼ëŠ” ê¸°ëŠ¥ê³¼ ìë°”ì—ì„œ ì§€ì›í•´ì£¼ëŠ” ê¸°ëŠ¥ ë‘ ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.

### 1. ObjectProvider

```java
// ClientBean(ì‹±ê¸€í†¤)

    static class ClientBean {
        private final ObjectProvider<PrototypeBean> prototypeBeanProvider;
        
        @Autowired
        public ClientBean(ObjectProvider<PrototypeBean> prototypeBeanProvider) { 
        	this.prototypeBeanProvider = prototypeBeanProvider;
        }
        
        public int logic() {
            PrototypeBean prototypeBean = prototypeBeanProvider.getObject(); // ì¶”ê°€ë¨
            prototypeBean.addCount();
            int count = prototypeBean.getCount();
            return count;
        }
    }
```

ì˜ì¡´ì„±ì„ ë°›ì„ ë•Œ ObjectProvider <> íƒ€ì…ìœ¼ë¡œ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ë°›ì€ í›„ getObject()ë¡œ í•´ë‹¹ ë¹ˆì„ ê°€ì ¸ì™€ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤. ìŠ¤í”„ë§ì— ì˜ì¡´í•˜ê³  ìˆë‹¤ëŠ” íŠ¹ì§•ì´ ìˆìŠµë‹ˆë‹¤.

### 2. JSR-330 Provider

ìš°ì„  ì–˜ëŠ” gradleì— ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.

```java
// build.gradle

dependencies {
	...
	implementation 'jakarta.inject:jakarta.inject-api:2.0.1'
}
```

ê·¸ í›„ Provider <> íƒ€ì…ìœ¼ë¡œ ë°›ì•„ì˜¤ë©´ ëœë‹¤. ìœ„ì˜ ObjectProviderë‘ ë¹„ìŠ·í•©ë‹ˆë‹¤.

![](https://blog.kakaocdn.net/dn/QoWF8/btsFK85iTMi/L4q6XXMpmMuKLyVwoo6W8K/img.png)

(jakarta.injectì˜ Providerë¡œ ê°€ì ¸ì˜¤ì!!)

```java
// ClientBean(ì‹±ê¸€í†¤)

    static class ClientBean {
        private final Provider<PrototypeBean> prototypeBeanProvider;
        
        @Autowired
        public ClientBean(Provider<PrototypeBean> prototypeBeanProvider) { 
        	this.prototypeBeanProvider = prototypeBeanProvider;
        }
        
        public int logic() {
            PrototypeBean prototypeBean = prototypeBeanProvider.get(); // ì–˜ê°€ getObjectê°€ ì•„ë‹Œ get
            prototypeBean.addCount();
            int count = prototypeBean.getCount();
            return count;
        }
    }
```

ì–˜ëŠ” get() ë©”ì„œë“œë¡œ ë¹ˆì„ ë°›ì•„ì˜µë‹ˆë‹¤. íŠ¹ì§•ìœ¼ë¡œëŠ” ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”í•˜ë©° ìë°” í‘œì¤€ì´ê¸° ë•Œë¬¸ì— ìŠ¤í”„ë§ì´ ì•„ë‹Œ ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì‹¤í–‰ ê²°ê³¼**

![](https://blog.kakaocdn.net/dn/mFDio/btsFNpLlhZq/mG4SNAM4IaHueBWA0B2fR0/img.png)

ë³„ê°œë¡œ logic()ì´ ì‘ìš©í•´ì„œ 2ê°€ ì•„ë‹Œ 1ì´ ë‚˜ì™€ì•¼ í•˜ê¸° ë•Œë¬¸ì— í…ŒìŠ¤íŠ¸ëŠ” ì‹¤íŒ¨í•©ë‹ˆë‹¤.

---
# ì›¹ ìŠ¤ì½”í”„

ì–˜ëŠ” ì›¹ í™˜ê²½ì—ì„œë§Œ ë™ì‘í•˜ëŠ” ì• ì…ë‹ˆë‹¤.

ì›¹ì€ ì—¬ëŸ¬ ë‹¤ì–‘í•œ ì‚¬ìš©ìë“¤ì´ ë™ì‹œë‹¤ë°œì ìœ¼ë¡œ ì‘ì—…ì„ ìš”ì²­í•˜ê²Œ ë©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ë§Œë“¤ì–´ì§„ ë¹ˆ ìŠ¤ì½”í”„ì¸ë°ìš”!
ì–˜ëŠ” ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì›¹ ìš”ì²­ì´ ì‹œì‘í•˜ë©´ì„œ ë¹ˆì„ ë§Œë“¤ì–´ì£¼ê³  ìš”ì²­ì´ ëë‚˜ë©´ì„œ ì—†ì• ì£¼ë©° ê´€ë¦¬í•´ ì£¼ê¸° ë•Œë¬¸ì— PreDestroyê°€ í˜¸ì¶œ ê°€ëŠ¥í•©ë‹ˆë‹¤.

ìœ„ì—ì„œ ë³´ì…¨ë‹¤ì‹œí”¼ ì›¹ ìŠ¤ì½”í”„ëŠ” ì¢…ë¥˜ê°€ í•˜ë‚˜ê°€ ì•„ë‹Œ ì—¬ëŸ¬ ê°€ì§€ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ë²”ìœ„ë§Œ ë‹¤ë¥´ì§€ ë™ì‘ ë°©ì‹ì€ ë¹„ìŠ·í•˜ê¸° ë•Œë¬¸ì— ì—¬ê¸°ì„  request ìŠ¤ì½”í”„ í•˜ë‚˜ë§Œ ë‹¤ë£¨ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

![](https://blog.kakaocdn.net/dn/cTrLGp/btsFKL3ElxM/nTtTLG5D3aCRmomI8b72Y0/img.png)

ìš°ì„  ì €í¬ëŠ” ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ì‹œìŠ¤í…œì„ êµ¬í˜„í•œë‹¤ê³  í•´ë´…ì‹œë‹¤. ì•„ë˜ì™€ ê°™ì´ ë§ì´ì£ 

> [d06 b992 f...] request scope bean create  
> [d06 b992 f...][http://localhost:8080/log-demo] controller test  
> [d06b992f...][http://localhost:8080/log-demo] service id = testId  
> [d06b992f...] request scope bean close

ë§¨ ì•ì—ëŠ” UUIDë¼ëŠ” ì‚¬ìš©ìë§ˆë‹¤ì˜ ê³ ìœ  IDê°’ì„ ë„£ê³  ì–´ë–¤ urlì„ ìš”ì²­í•´ì„œ ë‚¨ì€ ë¡œê·¸ì¸ì§€ë„ í™•ì¸í•´ ë´…ì‹œë‹¤.
ì•„ë˜ ì‚¬ì§„ê³¼ ê°™ì´ íŒ¨í‚¤ì§€ì™€ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì¤ì‹œë‹¤.

![](https://blog.kakaocdn.net/dn/br4QzE/btsFNolo9bW/OUwh8CzFBjqf5tvP45smWK/img.png)

```java
// MyLogger.java

package com.naver.shopping.webScope;

import jakarta.annotation.PostConstruct;
import jakarta.annotation.PreDestroy;
import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Component;

import java.util.UUID;

@Component
@Scope("request")
public class MyLogger {

    private String uuid;
    private String requestURL;
    
    public void setRequestURL(String requestURL) {
        this.requestURL = requestURL;
    }
    
    public void log(String message) {
        System.out.println("[" + uuid + "] [" + requestURL + "] " +message);
    }
    
    @PostConstruct
    public void init() {
        uuid = UUID.randomUUID().toString();
        System.out.println("[" + uuid + "] request scope bean create:" + this);
    }
    
    @PreDestroy
    public void close() {
        System.out.println("[" + uuid + "] request scope bean close:" + this);
    }
}
```

PostConstruct ë‹¨ê³„ì—ì„œ UUIDë¥¼ ì§€ì •í•˜ê²Œ ë˜ê³ , ScopeëŠ” "request"ë¡œ ì§€ì •ë˜ì–´ ìš”ì²­ì´ ì´ë£¨ì–´ì§ˆ ë•Œë§ˆë‹¤ í•´ë‹¹ ìš”ì²­ë§ˆë‹¤ í•˜ë‚˜ì”© ìƒì„±ë˜ê³ , ìš”ì²­ì´ ëë‚˜ë©´ì„œ ì†Œë©¸ë©ë‹ˆë‹¤.

```java
// LogService.java

package com.naver.shopping.webScope;

import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

@Service
@RequiredArgsConstructor
public class LogService {
    private final MyLogger myLogger;
    public void logic(String id) {
        myLogger.log("service id = " + id);
    }
}
```

MyLoggerë¡œ serviceì— ì ‘ì†í–ˆì„ ë•Œ ë¡œê·¸ë¥¼ ë‚¨ê¸¸ ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

```java
// LogController.java

package com.naver.shopping.webScope;

import jakarta.servlet.http.HttpServletRequest;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

@Controller
@RequiredArgsConstructor
public class LogController {
    private final LogService logService;
    private final MyLogger myLogger;
    
    @RequestMapping("log-demo")
    @ResponseBody
    public String logDemo(HttpServletRequest request) {
        String requestURL = request.getRequestURL().toString();
        myLogger.setRequestURL(requestURL);
        myLogger.log("controller test");
        logService.logic("testId");
        return "OK";
    }
}
```

/log-demoì— ì ‘ì†í–ˆì„ ë•Œì˜ ìƒí™©ì„ Controllerì—ì„œ ì‘ì„±í•´ ì¤ë‹ˆë‹¤. ì•„ê¹Œ ë§Œë“¤ì—ˆë˜ controller ë‚´ì—ì„œë„ ë¡œê·¸ë¥¼ ë‚¨ê²¨ì£¼ê³  serviceì˜ logic()ì„ ì‹¤í–‰í•´ ì£¼ëŠ” ì‘ì—…ì„ í•´ì¤ì‹œë‹¤.

ì¢‹ì•„ìš”. ì´ì œ ShoppingApplicationì„ ì‹¤í–‰í•´ ë´…ì‹œë‹¤!

**ê²°ê³¼ í™”ë©´**

> Caused by: org.springframework.beans.factory.support.ScopeNotActiveExcepti on: Error creating bean with name 'myLogger': Scope 'request' is not active for the current thread; consider defining a scoped proxy for this bean if you intend to refer to it from a singleton

ì—¥ ì´ëŸ° ì—ëŸ¬ê°€ ë– ë²„ë¦½ë‹ˆë‹¤.Â 

ì´ ì˜¤ë¥˜ ë©”ì‹œì§€ëŠ” request ìŠ¤ì½”í”„ ë¹ˆì„ ì‹±ê¸€í„´ ë¹ˆì—ì„œ ì§ì ‘ ì°¸ì¡°í•˜ë ¤ê³  í•  ë•Œ ë‚˜íƒ€ë‚˜ëŠ” ì˜¤ë¥˜ì…ë‹ˆë‹¤.
request ìŠ¤ì½”í”„ ë¹ˆì€ ê³ ê°ì˜ ìš”ì²­ì´ ì™€ì•¼ ìƒì„±í•  ìˆ˜ ìˆëŠ”ë° ì‹±ê¸€í„´ ë¹ˆì´ ì°¸ì¡°í•˜ë©´ì„œ ìŠ¤í”„ë§ì´ ì„œë²„ê°€ ì‹œì‘í•˜ìë§ˆì ìƒì„±ì„ ì‹œë„í•˜ë ¤ê³  í•´ì„œ ê·¸ë ‡ìŠµë‹ˆë‹¤.

## **ì˜¤ë¥˜ë¥¼ í•´ê²°í•˜ì**  

ì§€ê¸ˆ ë¬¸ì œê°€ ë˜ëŠ” ì´ìœ ê°€ ì–´ì§¸ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì‹±ê¸€í†¤ íƒ€ì…ì˜ ë¹ˆì— ì˜ì¡´ê´€ê³„ ì£¼ì…í–ˆì„ ë•Œì˜ ë¬¸ì œë‘ ë¹„ìŠ·í•˜ë„¤ìš”.
ê·¸ëŸ¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ Providerë¥¼ ì‚¬ìš©í•´ì„œ MyLogger ë¹ˆì„ ë¶ˆëŸ¬ë´…ì‹œë‹¤.

```java
// LogService.java

package com.naver.shopping.webScope;

import lombok.RequiredArgsConstructor;
import org.springframework.beans.factory.ObjectProvider;
import org.springframework.stereotype.Service;

@Service
@RequiredArgsConstructor
public class LogService {
    private final ObjectProvider<MyLogger> myLoggerProvider;
    public void logic(String id) {
        MyLogger myLogger = myLoggerProvider.getObject();
        myLogger.log("service id = " + id);
    }
}
```

```java
// LogController.java

package com.naver.shopping.webScope;

import jakarta.servlet.http.HttpServletRequest;
import lombok.RequiredArgsConstructor;
import org.springframework.beans.factory.ObjectProvider;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

@Controller
@RequiredArgsConstructor
public class LogController {
    private final LogService logService;
    private final ObjectProvider<MyLogger> myLoggerProvider;
    @RequestMapping("log-demo")
    @ResponseBody
    public String logDemo(HttpServletRequest request) {
        MyLogger myLogger = myLoggerProvider.getObject();
        String requestURL = request.getRequestURL().toString();
        myLogger.setRequestURL(requestURL);
        myLogger.log("controller test");
        logService.logic("testId");
        return "OK";
    }
}
```

**ì‹¤í–‰ ê²°ê³¼**

![](https://blog.kakaocdn.net/dn/cJxegq/btsFMOSooHK/FU6fLpnKu0BlnEsiH9Ootk/img.png)

ì›¹ ì„œë²„ê°€ ì˜ ì‹¤í–‰ëìŠµë‹ˆë‹¤!

http://localhost:8080/log-demoë¡œ ì ‘ì†í•œ í›„ ì¶”ê°€ë˜ëŠ” logë¥¼ í™•ì¸í•´ ë´…ì‹œë‹¤.

![](https://blog.kakaocdn.net/dn/bf7WAP/btsFLS12fl9/pecqY6eEr10DTNkhqzJkXk/img.png)

ì´ ì ‘ì†í•˜ê³  2ë²ˆì˜ ìƒˆë¡œê³ ì¹¨ì„ í•˜ì—¬ ì´ 3ë²ˆì˜ ì ‘ì†ì´ ì´ë£¨ì–´ì¡ŒìŠµë‹ˆë‹¤.

ë³´ì‹œë©´ ì ‘ì†í•˜ë©´ì„œ UUIDê°€ ìƒˆë¡œ ì ìš©ë˜ëŠ” ê²ƒì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ì ‘ì†í•œ urlì„ ì˜ ê°€ì ¸ì˜¤ê³ , ê·¸ë¦¬ê³  ê°ê°ì˜ ì ‘ì†ë“¤ì˜ MyLoggerì˜ ì•„ì´ë””ê°€ ë‹¤ë¥´ë‹¤ëŠ” ê²ƒì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---
# í”„ë¡ì‹œ ë°©ì‹ì„ ì¨ë³´ì

ì´ë ‡ê²Œ Provider ë°©ì‹ìœ¼ë¡œëŠ” ì„±ì— ì•ˆ ì°¼ë˜ ì½”ë”© ê³ ì¸ë¬¼ë¶„ë“¤ì€ Proxyë¼ëŠ” ë°©ë²•ìœ¼ë¡œ í•´ë‹¹ ë¬¸ì œë¥¼ í•´ê²°í•˜ê²Œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

í•œë²ˆ í•´ë³´ì£ ! ë¨¼ì €Â Providerë¥¼ ì ìš©í–ˆë˜ ë°©ê¸ˆ ë°©ì‹ìœ¼ë¡œ ì›ë˜ëŒ€ë¡œ ëŒë ¤ì£¼ì„¸ìš”. ê·¸ë¦¬ê³  MyLoggerì˜ @Scope ì–´ë…¸í…Œì´ì…˜ì„ ìˆ˜ì •í•´ ì£¼ì„¸ìš”.

```java
// MyLogger.java

@Component
@Scope(value = "request", proxyMode = ScopedProxyMode.TARGET_CLASS)
public class MyLogger {
	...
}
```

**ì‹¤í–‰ ê²°ê³¼**

![](https://blog.kakaocdn.net/dn/swKoG/btsFNxijbPm/cKKkehMcxwqRdj6m9NVjE0/img.png)

ë¡œê·¸ê°€ ì˜ ìƒê¸°ê³  ìˆìŠµë‹ˆë‹¤.

ScopedProxyModeëŠ” ì•„ë˜ì™€ ê°™ì´ ì§€ì •í•´ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì €í¬ëŠ” MyLoggerë¼ëŠ” í´ë˜ìŠ¤ë¥¼ í”„ë¡ì‹œëª¨ë“œë¡œ ì§€ì •í•  ì˜ˆì •ì´ë¼ TARGET_CLASSë¥¼ ë„£ì—ˆê³ , ì¸í„°í˜ì´ìŠ¤ëŠ” INTERFACE ì´ë ‡ê²Œ ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.

![](https://blog.kakaocdn.net/dn/HbMia/btsFMOEQB4g/daaWaqfREyuU1mlcxfHPd0/img.png)

ê·¸ë¦¬ê³  í”„ë¡ì‹œ ëª¨ë“œëŠ” ê¼­ ì›¹ ìŠ¤ì½”í”„ì—ë§Œ ì“¸ ìˆ˜ ìˆëŠ”ê²ƒì€ ì•„ë‹ˆë¼ í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ ë“±ì— ì‚¬ìš©í•˜ì…”ë„ ë©ë‹ˆë‹¤.

ì´ í”„ë¡ì‹œ ëª¨ë“œë¥¼ ì„¤ì •í•˜ê²Œ ë˜ë©´ MyLoggerë¥¼ ìƒì†ë°›ì€ ê°€ì§œ ê°ì²´ê°€ ë¹ˆìœ¼ë¡œ ë“±ë¡ì´ ë©ë‹ˆë‹¤.
ê·¸ë˜ì„œ ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ ì´ ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ë¡œ ì£¼ì…ì´ ë©ë‹ˆë‹¤.
ê·¸ë¦¬ê³  ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ê°€ í˜¸ì¶œì„ ë°›ìœ¼ë©´ ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ëŠ” ì§„ì§œ í”„ë¡ì‹œ ê°ì²´ë¥¼ ì°¾ì•„ì„œ í˜¸ì¶œì„ ì‹œì¼œì£¼ëŠ” ì—­í• ì„ í•˜ê²Œ ë©ë‹ˆë‹¤.

![](https://blog.kakaocdn.net/dn/uHyKS/btsFJ4JfdKH/TsRYbpiE0JBu9W4qlmeNAK/img.png)

---
# ë§ˆì¹˜ë©°

ì™€!!! ë“œë””ì–´ ì €í¬ê°€ ë°°ì›Œì•¼ í•  ê¸°ë³¸ì ì¸ ìŠ¤í”„ë§ ê¸°ëŠ¥ë“¤ì´ ë§ˆë¬´ë¦¬ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.

ì˜¤ëŠ˜ ë°°ìš´ ì¡°ê¸ˆ íŠ¹ë³„í•œ ScopeëŠ” ê¼­ í•„ìš”í•œ ê³³ì—ì„œë§Œ ìµœì†Œí™”í•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²Œ ìœ ì§€ë³´ìˆ˜ì— ì¢‹ì„ ê²ƒì…ë‹ˆë‹¤.

ì§€ê¸ˆê¹Œì§€ ê³ ìƒ ë§ìœ¼ì…¨ê³ , ë‹¤ìŒì— ë” ì‘ì„±í•˜ê²Œ ëœë‹¤ë©´ ì›¹ ìª½ìœ¼ë¡œ ë” ì‹¬í™”í•˜ì—¬ ì‘ì„±í•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤!!

ì˜¤ëŠ˜ ì‘ì—…í•œ ë‚´ì—­ì€ ì•„ë˜ ì»¤ë°‹ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.


[Learn Prototype Scope and Request Scope Â· KIMB0B/blog_spring@d4ebc9c (github.com)](https://github.com/KIMB0B/blog_spring/commit/d4ebc9c55c941ad75094e86d78132049ad434251)